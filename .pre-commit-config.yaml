repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-yaml
        exclude: pnpm-lock.yaml
      - id: check-toml
      - id: check-json
      - id: end-of-file-fixer
        exclude: ^free-todo-frontend/lib/generated/
      - id: trailing-whitespace
        exclude: ^free-todo-frontend/lib/generated/
        args: [--markdown-linebreak-ext=md]
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.10
    hooks:
      # Run the linter.
      - id: ruff
        # It is recommended to specify the latest version of Python
        # supported by your project here, or alternatively use
        # pre-commit's default_language_version, see
        # https://pre-commit.com/#top_level-default_language_version
        language_version: python3.12
        files: ^lifetrace/
        exclude: ^lifetrace/migrations/versions/
        types_or: [ python, pyi ]
        args: [ --fix ]
      # Run the formatter.
      - id: ruff-format
        language_version: python3.12
        files: ^lifetrace/
        types_or: [ python, pyi ]
  # Biome for frontend (JavaScript/TypeScript)
  - repo: https://github.com/biomejs/pre-commit
    rev: "v0.6.1"
    hooks:
      - id: biome-check
        additional_dependencies: ["@biomejs/biome@2.3.8"]
        files: ^(free-todo-frontend/)
  # TypeScript type checking for free-todo-frontend
  - repo: local
    hooks:
      - id: tsc-free-todo-frontend
        name: TypeScript type check (free-todo-frontend)
        entry: bash -c 'cd free-todo-frontend && pnpm run type-check'
        language: system
        files: ^free-todo-frontend/.*\.(ts|tsx)$
        pass_filenames: false

      # 前端 TS/TSX 有效代码行数检查（不含空行和注释，上限 500 行）
      # pre-commit 会传入暂存的文件，只检查这些文件
      - id: check-frontend-code-lines
        name: Check frontend TS/TSX code lines (max 500)
        entry: node free-todo-frontend/scripts/check_code_lines.js --include apps,components,electron,lib --exclude lib/generated
        language: system
        files: ^free-todo-frontend/.*\.(ts|tsx)$
        pass_filenames: true

      # 后端 Python 有效代码行数检查（不含空行和注释，上限 500 行）
      # pre-commit 会传入暂存的文件，只检查这些文件
      - id: check-backend-code-lines
        name: Check backend Python code lines (max 500)
        entry: uv run python lifetrace/scripts/check_code_lines.py --include lifetrace --exclude lifetrace/__pycache__,lifetrace/dist,lifetrace/migrations/versions
        language: system
        files: ^lifetrace/.*\.py$
        pass_filenames: true

      # Tauri Rust 有效代码行数检查（不含空行和注释，上限 500 行）
      # pre-commit 会传入暂存的文件，只检查这些文件
      - id: check-tauri-rust-code-lines
        name: Check Tauri Rust code lines (max 500)
        entry: node free-todo-frontend/scripts/check_rust_code_lines.js --include src-tauri/src --exclude src-tauri/target
        language: system
        files: ^free-todo-frontend/src-tauri/.*\.rs$
        pass_filenames: true

      # Rust format check (rustfmt)
      - id: rustfmt
        name: Rust format (rustfmt)
        entry: python scripts/precommit_rustfmt.py
        language: python
        files: ^free-todo-frontend/src-tauri/.*\.rs$
        pass_filenames: false

      # Rust linter (clippy)
      - id: clippy
        name: Rust linter (clippy)
        entry: python scripts/precommit_clippy.py
        language: python
        files: ^free-todo-frontend/src-tauri/.*\.rs$
        pass_filenames: false
