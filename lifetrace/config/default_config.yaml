# LifeTrace 默认配置文件

# ！！！重要提示：
# 请勿编辑此文件 default_config.yaml，所有配置都应在 config.yaml 中进行设置
# 如果 config.yaml 不存在，系统会自动从 default_config.yaml 复制并生成
# 如果 config.yaml 存在，系统会自动验证完整性，如果不完整，系统会自动提示并退出
# 当此提示出现在 config.yaml 中时，请忽略

# 服务器配置
server:
  host: 127.0.0.1
  port: 8001 # 默认端口 8001，保留 8000 给其他服务
  debug: false

# 后端模块启用配置（轻量插件化）
backend_modules:
  enabled:
    - health
    - config
    - system
    - logs
    - chat
    - activity
    - search
    - screenshot
    - event
    - ocr
    - vector
    - rag
    - scheduler
    - cost_tracking
    - time_allocation
    - todo
    - todo_extraction
    - journal
    - vision
    - notification
    - floating_capture
    - audio
    - proactive_ocr

# 基础目录配置
base_dir: data
database_path: lifetrace.db
screenshots_dir: screenshots/
attachments_dir: attachments/

# 日志配置
logging:
  level: INFO
  console_level: INFO
  file_level: INFO
  quiet_modules: [] # 示例: ["activity_service", "event_service"]
  log_path: logs/

# 调度器配置
scheduler:
  enabled: true # 启用调度器
  database_path: scheduler.db # 调度器数据库路径
  max_workers: 10 # 最大工作线程数
  coalesce: true # 合并错过的任务
  max_instances: 1 # 同一任务同时只能有一个实例
  misfire_grace_time: 60 # 错过触发时间的容忍度（秒）
  timezone: Asia/Shanghai # 时区

# 定时任务
jobs:
  recorder:
    id: recorder # 任务ID
    name: '屏幕录制' # 任务显示名称（中文）
    enabled: false # 是否启用录制器任务（默认关闭，需用户手动开启）
    interval: 10 # 截图间隔（秒）
    params:
      screens: all # 截图屏幕：all 或屏幕编号列表
      auto_exclude_self: true # 自动排除 LifeTrace 自身窗口
      deduplicate: true # 启用截图去重（通过文件哈希避免保存重复截图）
      hash_threshold: 5 # 图像哈希去重阈值（汉明距离），值越小越严格
      file_io_timeout: 15 # 文件I/O操作超时时间（秒）
      db_timeout: 20 # 数据库操作超时时间（秒）
      window_info_timeout: 5 # 获取窗口信息超时时间（秒）
      blacklist:
        enabled: false # 是否启用黑名单功能
        apps: ['微信'] # 应用黑名单，使用友好名称，例如: ["微信", "QQ", "钉钉"]
        windows: [] # 窗口标题黑名单，例如: ["记事本", "计算器"]
  auto_todo_detection:
    id: auto_todo_detection # 任务ID
    name: 自动待办检测 # 任务显示名称（中文）
    enabled: false # 是否启用自动待办检测（默认关闭，需用户手动开启）
    params:
      whitelist:
        apps: ['微信', 'WeChat', '飞书', 'Feishu', 'Lark', '钉钉', 'DingTalk'] # 应用白名单，只有这些应用的截图才会触发自动待办检测
  todo_recorder:
    id: todo_recorder # 任务ID
    name: '屏幕录制（Todo生成）' # 任务显示名称（中文）
    enabled: false # 是否启用 Todo 专用录制（默认关闭，与 auto_todo_detection 联动）
    interval: 5 # 截图间隔（秒），默认5秒
    params:
      # 白名单应用从 auto_todo_detection.params.whitelist.apps 读取，无需重复配置
      deduplicate: true # 启用截图去重
      hash_threshold: 5 # 图像哈希去重阈值（汉明距离）
      file_io_timeout: 15 # 文件I/O操作超时时间（秒）
      db_timeout: 20 # 数据库操作超时时间（秒）
      window_info_timeout: 5 # 获取窗口信息超时时间（秒）
  ocr:
    id: ocr # 任务ID
    name: OCR识别 # 任务显示名称（中文）
    enabled: false # 是否启用OCR任务（默认关闭，需用户手动开启）
    interval: 10 # 数据库检查间隔（秒）
    params:
      use_gpu: false
      language: ['ch', 'en']
      confidence_threshold: 0.5
  audio_recording:
    id: audio_recording # 任务ID
    name: 音频录制 # 任务显示名称（中文）
    enabled: false # 是否启用音频录制（默认关闭，7x24小时录制）
    interval: 60 # 状态检查间隔（秒），用于监控录音状态
    params:
      segment_duration_minutes: 30 # 分段时长（分钟）
      silence_threshold_seconds: 600 # 静音检测阈值（秒）
  activity_aggregator:
    id: activity_aggregator # 任务ID
    name: 活动聚合 # 任务显示名称（中文）
    enabled: false # 是否启用活动聚合任务（默认关闭，需用户手动开启）
    interval: 900 # 检查间隔（秒），默认15分钟
  clean_data:
    id: clean_data # 任务ID
    name: 截图清理 # 任务显示名称（中文）
    enabled: false # 是否启用截图清理任务（默认关闭，需要时手动开启）
    interval: 3600 # 检查间隔（秒），默认每小时检查一次
    params:
      max_screenshots: 10000 # 最大截图数量限制
      max_days: 30 # 数据保留天数（按日期清理旧数据）
      delete_file_only: true # 只删除文件（true），还是同时删除记录（false）
  deadline_reminder:
    id: deadline_reminder # 任务ID
    name: DDL提醒 # 任务显示名称（中文）
    enabled: false # 是否启用 DDL 提醒任务（默认关闭，需用户手动开启）
    interval: 30 # 检查间隔（秒），默认30秒检查一次
    params:
      reminder_window_minutes: 5 # 提醒时间窗口（分钟），在 DDL 前多少分钟提醒
  proactive_ocr:
    id: proactive_ocr # 任务ID
    name: 主动OCR # 任务显示名称（中文）
    enabled: false # 是否启用主动OCR任务（默认关闭，需用户手动开启，仅Windows）
    interval: 1.0 # 检测间隔（秒），默认1秒
    params:
      apps: ["wechat", "feishu"] # 目标应用列表
      use_roi: true # 是否使用ROI裁切加速（只识别聊天区域）
      resize_max_side: 800 # 图像预缩放最大边长，0表示不缩放
      det_limit_side_len: 640 # OCR检测输入边长限制
      min_confidence: 0.8 # 最低置信度阈值
      auto_extract_todos: true # 是否在识别后自动触发基于 OCR 文本的待办提取
      min_text_length: 5 # 触发自动待办提取所需的最小文本长度（按字符数）

# 向量数据库配置
vector_db:
  enabled: true # 启用向量数据库
  collection_name: lifetrace_ocr # 集合名称
  embedding_model: shibing624/text2vec-base-chinese # 嵌入模型
  rerank_model: BAAI/bge-reranker-base # 重排序模型
  persist_directory: vector_db # 持久化目录

# 聊天配置
chat:
  enable_history: true # 开启后发送消息时附带历史上下文
  history_limit: 10 # 历史记录轮数限制（1轮=1个用户消息+1个助手回复）

# LLM配置
llm:
  api_key: YOUR_LLM_KEY_HERE # LLM 密钥，需要用户配置
  base_url: https://dashscope.aliyuncs.com/compatible-mode/v1 # LLM API基础URL
  model: qwen-plus # 使用的模型名称
  vision_model: qwen3-vl-plus # 视觉多模态模型名称（用于图片分析）
  temperature: 0.7 # 温度参数
  max_tokens: 2048 # 最大token数
  # 模型价格配置（单位：人民币/千token）
  model_prices:
    default: # 默认价格，用于未配置的模型（qwen-plus）
      input_price: 0.0008 # 输入token价格
      output_price: 0.002 # 输出token价格
    qwen3-max:
      input_price: 0.0032
      output_price: 0.0128
    qwen-plus:
      input_price: 0.0008
      output_price: 0.002
    qwen-turbo:
      input_price: 0.0003
      output_price: 0.0006
    qwen3-vl-plus: # 视觉模型价格（支持非思考/思考模式，按输入token分层计价）
      # 兼容旧逻辑的基础单价（默认取第一档）
      input_price: 0.001 # 输入token价格（元/千token）
      output_price: 0.01 # 输出token价格（元/千token）
      tiers:
        # (0, 32,000]
        - max_input_tokens: 32000
          input_price: 0.001
          output_price: 0.01
        # (32,000, 128,000]
        - max_input_tokens: 128000
          input_price: 0.0015
          output_price: 0.015
        # (128,000, 256,000]
        - max_input_tokens: 256000
          input_price: 0.003
          output_price: 0.03

# Tavily 配置（联网搜索）
tavily:
  api_key: YOUR_TAVILY_API_KEY_HERE # Tavily API Key，需要用户配置
  search_depth: basic # 搜索深度：basic 或 advanced
  max_results: 5 # 最大返回结果数
  include_domains: [] # 包含的域名列表（可选）
  exclude_domains: [] # 排除的域名列表（可选）

# 音频识别配置（阿里云Fun-ASR）
audio:
  is_24x7: false # 7x24小时录制模式（自动启动录音，默认关闭）
  asr:
    api_key: YOUR_LLM_KEY_HERE # 阿里云百炼API Key
    base_url: wss://dashscope.aliyuncs.com/api-ws/v1/inference/ # WebSocket地址
    model: fun-asr-realtime # 使用的模型名称
    sample_rate: 16000 # 采样率（Hz）
    format: pcm # 音频格式：pcm, wav, mp3, opus, speex, aac, amr
    semantic_punctuation_enabled: false # 是否开启语义断句
    max_sentence_silence: 1300 # VAD静音时长阈值（毫秒）
    heartbeat: false # 是否开启长连接保持
  storage:
    audio_dir: audio/ # 音频文件存储目录
    temp_audio_dir: temp_audio/ # 临时音频文件目录

# 可观测性配置（Phoenix + OpenInference）
observability:
  enabled: true # 是否启用观测功能（默认关闭，需用户手动开启）
  mode: both # 导出模式：local（本地JSON文件）| phoenix（Phoenix UI）| both（两者都启用）
  local:
    traces_dir: traces/ # trace 文件存储目录（相对于 base_dir）
    max_files: 100 # 最大保留文件数（超出后自动清理旧文件）
    pretty_print: true # JSON 是否格式化输出（便于人类阅读）
  phoenix:
    endpoint: http://localhost:6006 # Phoenix 服务端点（需先启动 phoenix serve）
    project_name: freetodo-agent # 项目名称（用于 Phoenix UI 中分组）
    export_timeout_sec: 2.0 # 导出超时（秒），避免 Phoenix 不可用时阻塞
    disable_after_failures: 1 # 连续失败达到阈值后自动禁用 Phoenix 导出
    retry_cooldown_sec: 60 # 触发禁用后多久尝试恢复（秒，0 表示不自动重试）
  terminal:
    summary_only: true # Terminal 是否只输出一行摘要（推荐 true，保持日志精简）
